#!/bin/bash
# search by path and file suffix, if grep true open file
# TODO:
# Requested fill size "/var/log/syslog" is invalid while trying to open with nano -r -v
# Received SIGHUP or SIGTERM while trying to open with nano
# no workaround the signal-handler from less, if SIGINT trapped from script, less still catches the signal SIGINT
LANG=C;
FILE="search" ;
line='' ;
#exithandler
trap "$FILE && pgrep $FILE | awk '{print $1}' | xargs kill -9 && pgrep less | awk '{print $1}' | xargs kill -9;" SIGINT ;

				if [ "$EUID" != 0 ] ;
			then
				echo "sudo search -h :: please"
		else
# temp folder
                if [[ "$(df -h | grep -E shm$ | cut -f2 -d% | tr -d '\ ')" != '' ]] ;
        then
                #shm volatile
                tmpfolder="$(df -h | grep -E shm$ | cut -f2 -d% | tr -d '\ ')" ;
        else
                tmpfolder="/tmp" ;
fi
#               temp folder END
# temp file

# the whole list just with file suffix, ready to grep the content, if true, file in an editor.
touch "$tmpfolder/$(date | awk '{print $2,$6}' | sed 's/\ //g').tmp" ;
tmpfile="$tmpfolder/$(date | awk '{print $2,$6}' | sed 's/\ //g').tmp" ;
#               temp file END

display(){
# display
echo -e "search $(date) :: as $USER :: in $(uname -n) :: in $path ::" >>"/home/$SUDO_USER/.wH0rUNSon" ;
		while read -r line ;
	do
		if [[ $(file "$line") =~ PHP|script|ASCII|text|TEXT|HTML|XML ]] ;
	then
			if [[ $(echo "$line" | xargs grep "$togrep3" 2>/dev/null) = '' ]] || \
			[[ $(echo "$line" | xargs grep "$togrep2" 2>/dev/null) = '' ]] && \
			[[ $(echo "$line" | xargs grep "$togrep1" 2>/dev/null) = '' ]] ;
		then
			echo -e " ... $(echo "$line" | xargs file) :: - nothing to show\r" ;
			pause=0 ;
		else
			usER=$(ls -sl "$line" | awk '{print $4}') ;
			sudo -u "$usER" less "$line";
			pause=1 ;
fi
		else
			echo -e " ... no PHP|script|ASCII|text|TEXT|HTML|XML \r" ;
			pause=0 ;
fi
	done <<<"$lines"
# 					display END
}

help(){
echo "Usage: $0 [-s|--search] [-h|--help] PATH FILE-SUFFIX TOGREP && || TOGREP && || TOGREP" ;
echo -e "\n sudo this script:\n
SEARCH THE DRIVE\n
 This script searches your drive\r
 for everything in it, and displays\r
 only text in the less viewer.\r
 Finds: log files, example code, etc.\r" ;
 # user workflow control 
exit 0 ;
	}

eingabe(){
shift 0 ;
pause=0 ;
for lines in $(find "$path" -name "*$suffixx*" -type f 2>/dev/null | tee "$tmpfile") ;
	do
		if [[ $pause = 1 ]] ;
	then
		read -r -p "continue? " && display && wait ;
	else
		display && wait ;
	fi ;
done
}

# ASK
  case "$1" in
        -s|--search|$2|$3|$4|$5|$6)
      path=$2
      suffixx=$3
      togrep1=$4
      togrep2=$5
      togrep3=$6
      toshiffta=$(echo "$path $suffixx $togrep1 $togrep2 $togrep3" | wc -w) ;
      shift "$toshiffta" ;
      eingabe ;
      ;;
   -h|--help)
      toshiffta=0 ;
      shift "$toshiffta" ;
      help ;
      ;;
  esac
		if [[ $1 = '' ]] && [[ "$line" = '' ]];
	then
		echo "Usage: $0 [-s|--search] [-h|--help] PATH FILE-SUFFIX TOGREP && || TOGREP && || TOGREP" ;
		echo "Try '$0 --help' for more information."
	else
		eingabe ;
	fi
fi
