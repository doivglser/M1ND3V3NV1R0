#!/bin/bash
# mindevenviro  
# search by path and file suffix, if grep true open file
LANG=C;
FILE="search" ;
line='' ;
#exithandler
trap 'pgrep $FILE | awk "{print $1}" | xargs kill -9 && pgrep less | awk "{print $1}" | xargs kill -9;' SIGINT ;

				if [ "$EUID" != 0 ] ;
			then
				echo "sudo search -h :: please"
		else
# temp folder
                if [[ "$(df -h | grep -E shm$ | cut -f2 -d% | tr -d '\ ')" != '' ]] ;
        then
                #shm volatile
                tmpfolder="$(df -h | grep -E shm$ | cut -f2 -d% | tr -d '\ ')" ;
        else
                tmpfolder="/tmp" ;
fi
#               temp folder END
# temp file

# the whole list just with file suffix, ready to grep the content, if true, file in an editor.
touch "$tmpfolder/$(date | awk '{print $2,$6}' | sed 's/\ //g').tmp" ;
tmpfile="$tmpfolder/$(date | awk '{print $2,$6}' | sed 's/\ //g').tmp" ;
#               temp file END

display(){
# display
echo -e "search $(date) :: as $USER :: in $(uname -n) :: in $path ::" >>"/home/$SUDO_USER/.wH0rUNSon" ;
		while read -r line ;
	do
		wait ;
	
		if [[ $(file "$line") =~ PDF|PHP|script|ASCII|text|TEXT|HTML|XML ]] ;
	then
			if [[ ! $(echo "$line" | xargs grep "$togrep" 2>/dev/null) = '' ]] ;
		then
			usER=$(ls -sl "$line" | awk '{print $4}') ;
			
			if [[ ! $(file "$line") =~ PDF ]] ;
		then
			sudo -u "$usER" less "$line";
			pause=1 ;
		else
			sudo -u "$SUDO_USER" mupdf "$line";
			pause=1 ;
		fi
		else
			echo -e " ... $(echo "$line" | xargs file) :: - nothing to show\r" ;
			pause=0 ;
fi
		else
			echo -e " ... no PDF|PHP|script|ASCII|text|TEXT|HTML|XML \r" ;
			pause=0 ;
fi
	done <<<"$lines"
# 					display END
}

help(){
shift 0 ;
echo "Usage: $0 [-s|--search] [PATH] [FILE-SUFFIX] [TOGREP] || [-h|--help] " ;
echo -e "\n sudo this script:\n
SEARCH THE DRIVE\n
 This script searches your drive\r
 for everything in it, and displays\r
 only text in the less viewer.\r
 Finds: log files, example code, etc.\r" ;
 # user workflow control 
exit 0 ;
	}

eingabe(){
pause=0 ;
for lines in $(find $path -regex '[a-zA-Z0-9\ \/\._]*' -type f 2>/dev/null | grep -E ".$suffixx" 2>/dev/null | tee "$tmpfile") ;
	do
		if [[ $pause = 1 ]] ;
	then
		read -r -p "continue? " && display && wait ;
	else
		display && wait ;
	fi ;
done
}

# ASK
  case "$1" in
        -s|--search)
      path=$2
      suffixx=$3
      togrep=$4
      toshiffta=$(echo "$path $suffixx $togrep" | wc -w) ;
      shift "$toshiffta" ;
      eingabe ;
      ;;
   -h|--help)
      toshiffta=0 ;
      shift "$toshiffta" ;
      help ;
      ;;
  esac
		if [[ ! $1 = '-s|--search|-h|--help' ]] ;
	then
		echo "Try '$0 --help' for more information."
	else
		eingabe ;
	fi
fi
